

<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.knitr.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
},
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0em 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage.left {
  text-align: left;
}
.rimage.right {
  text-align: right;
}
.rimage.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
  <title>A Report Generated by knitr</title>
</head>
<body>

  <p>This report is automatically generated with the R
    package <a href="http://yihui.name/knitr"><strong>knitr</strong></a>
    (version <code class="knitr inline">1.5</code>)
    .</p>

<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">################## Prepare data to work with</span>
<span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl num">FALSE</span><span class="hl std">) {</span>
    <span class="hl com"># get all of the data</span>
    <span class="hl std">all_data</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">readRDS</span><span class="hl std">(</span><span class="hl str">&quot;all_data_wide.rds&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">head</span><span class="hl std">(all_data)</span>
    <span class="hl kwd">dim</span><span class="hl std">(all_data)</span>  <span class="hl com"># 647 784</span>

    <span class="hl com"># split the data to training and testing:</span>
    <span class="hl std">n_rows_for_test</span> <span class="hl kwb">&lt;-</span> <span class="hl num">2000</span>  <span class="hl com"># 10^5</span>
    <span class="hl std">train</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">tail</span><span class="hl std">(all_data,</span> <span class="hl opt">-</span><span class="hl std">n_rows_for_test)</span>
    <span class="hl kwd">saveRDS</span><span class="hl std">(train,</span> <span class="hl str">&quot;train.rds&quot;</span><span class="hl std">)</span>
    <span class="hl std">test</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">tail</span><span class="hl std">(all_data, n_rows_for_test)</span>
    <span class="hl kwd">saveRDS</span><span class="hl std">(test,</span> <span class="hl str">&quot;test.rds&quot;</span><span class="hl std">)</span>  <span class="hl com"># this is used by the get_data function!\t</span>
<span class="hl std">}</span>


<span class="hl com">################## Start the work</span>

<span class="hl com"># set your working directory to where 'test.rds' is using setwd() getwd()</span>


<span class="hl com"># getwd() list.files()</span>
<span class="hl kwd">source</span><span class="hl std">(</span><span class="hl str">&quot;get_data.r&quot;</span><span class="hl std">)</span>

<span class="hl kwd">options</span><span class="hl std">(</span><span class="hl kwc">scipen</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl opt">^</span><span class="hl num">3</span><span class="hl std">)</span>
<span class="hl kwd">options</span><span class="hl std">(</span><span class="hl kwc">digits</span> <span class="hl std">=</span> <span class="hl num">10</span><span class="hl std">)</span>
<span class="hl com"># we have 1 billion of everything:</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##    money German10  German5     TYc1     US5Y  EUR_USD 
##  1000000        0        0        0        0        0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># with no bids:</span>
<span class="hl kwd">my_bids</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##       NA       NA       NA       NA       NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># at first, we see no new data, this is NULL:</span>
<span class="hl kwd">my_data</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## NULL
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Let's fetch 1 row of new data:</span>
<span class="hl kwd">get_data</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##                       DATE n_trades_German10 open_German10 high_German10 low_German10
## 645785 2013-10-30 17:41:00                27        141.47        141.47       141.45
##        close_German10 n_bids_German10 n_trades_German5 open_German5 high_German5
## 645785         141.45              46               14       124.88       124.88
##        low_German5 close_German5 n_bids_German5 n_trades_TYc1 open_TYc1 high_TYc1
## 645785      124.87        124.87             49           120    127.75    127.75
##        low_TYc1 close_TYc1 n_bids_TYc1 n_trades_US5Y open_US5Y high_US5Y  low_US5Y
## 645785   127.75     127.75         201            37 121.78125 121.78125 121.78125
##        close_US5Y n_bids_US5Y n_trades_EUR_USD open_EUR_USD high_EUR_USD low_EUR_USD
## 645785  121.78125         320               70       1.3761       1.3763      1.3761
##        close_EUR_USD n_bids_EUR_USD
## 645785        1.3761            366
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">get_data</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##                       DATE n_trades_German10 open_German10 high_German10 low_German10
## 645786 2013-10-30 17:42:00                21        141.45        141.45       141.44
##        close_German10 n_bids_German10 n_trades_German5 open_German5 high_German5
## 645786         141.45              32                1       124.87       124.87
##        low_German5 close_German5 n_bids_German5 n_trades_TYc1 open_TYc1  high_TYc1
## 645786      124.87        124.87             16           594    127.75 127.796875
##        low_TYc1 close_TYc1 n_bids_TYc1 n_trades_US5Y open_US5Y  high_US5Y  low_US5Y
## 645786   127.75 127.796875        1088           373 121.78125 121.796875 121.78125
##        close_US5Y n_bids_US5Y n_trades_EUR_USD open_EUR_USD high_EUR_USD low_EUR_USD
## 645786 121.796875         917              205       1.3761       1.3764      1.3761
##        close_EUR_USD n_bids_EUR_USD
## 645786        1.3761            502
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># now we have some data</span>
<span class="hl kwd">my_data</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##                       DATE n_trades_German10 open_German10 high_German10 low_German10
## 645785 2013-10-30 17:41:00                27        141.47        141.47       141.45
## 645786 2013-10-30 17:42:00                21        141.45        141.45       141.44
##        close_German10 n_bids_German10 n_trades_German5 open_German5 high_German5
## 645785         141.45              46               14       124.88       124.88
## 645786         141.45              32                1       124.87       124.87
##        low_German5 close_German5 n_bids_German5 n_trades_TYc1 open_TYc1  high_TYc1
## 645785      124.87        124.87             49           120    127.75 127.750000
## 645786      124.87        124.87             16           594    127.75 127.796875
##        low_TYc1 close_TYc1 n_bids_TYc1 n_trades_US5Y open_US5Y  high_US5Y  low_US5Y
## 645785   127.75 127.750000         201            37 121.78125 121.781250 121.78125
## 645786   127.75 127.796875        1088           373 121.78125 121.796875 121.78125
##        close_US5Y n_bids_US5Y n_trades_EUR_USD open_EUR_USD high_EUR_USD low_EUR_USD
## 645785 121.781250         320               70       1.3761       1.3763      1.3761
## 645786 121.796875         917              205       1.3761       1.3764      1.3761
##        close_EUR_USD n_bids_EUR_USD
## 645785        1.3761            366
## 645786        1.3761            502
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Let's make a change in our assets: currently we have no bids:</span>
<span class="hl kwd">my_bids</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##       NA       NA       NA       NA       NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Let's buy 100 German5 (in short!), and leave the other bids as they are:</span>
<span class="hl kwd">my_bids</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">NA</span><span class="hl std">,</span> <span class="hl opt">-</span><span class="hl num">100</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">))</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##       NA     -100       NA       NA       NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># our assets are the same:</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##    money German10  German5     TYc1     US5Y  EUR_USD 
##  1000000        0        0        0        0        0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># buy the assets</span>
<span class="hl kwd">get_data</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##                       DATE n_trades_German10 open_German10 high_German10 low_German10
## 645787 2013-10-30 17:43:00                11        141.45        141.45       141.44
##        close_German10 n_bids_German10 n_trades_German5 open_German5 high_German5
## 645787         141.45              53                1       124.87       124.87
##        low_German5 close_German5 n_bids_German5 n_trades_TYc1  open_TYc1  high_TYc1
## 645787      124.87        124.87             10           130 127.796875 127.796875
##         low_TYc1 close_TYc1 n_bids_TYc1 n_trades_US5Y  open_US5Y   high_US5Y   low_US5Y
## 645787 127.78125  127.78125         332           156 121.796875 121.8046875 121.796875
##        close_US5Y n_bids_US5Y n_trades_EUR_USD open_EUR_USD high_EUR_USD low_EUR_USD
## 645787 121.796875         360               36       1.3761       1.3761       1.376
##        close_EUR_USD n_bids_EUR_USD
## 645787         1.376            255
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_assets</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##    money German10  German5     TYc1     US5Y  EUR_USD 
##   987513        0     -100        0        0        0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_bids</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##       NA       NA       NA       NA       NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">estimated_total_money</span><span class="hl std">()</span>  <span class="hl com"># we don't seem to have made/lost any money</span>
</pre></div>
<div class="output"><pre class="knitr r">##   money 
## 1000000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># let's move forward in time and see what happens: Now let's ask for 99 more rows:</span>
<span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">300</span><span class="hl std">)</span> <span class="hl kwd">get_data</span><span class="hl std">()</span>
<span class="hl com"># Now let's see the data we got thus far: options(digits = 5)</span>
<span class="hl kwd">dim</span><span class="hl std">(</span><span class="hl kwd">my_data</span><span class="hl std">())</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] 303  31
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">head</span><span class="hl std">(</span><span class="hl kwd">my_data</span><span class="hl std">())</span>
</pre></div>
<div class="output"><pre class="knitr r">##                       DATE n_trades_German10 open_German10 high_German10 low_German10
## 645785 2013-10-30 17:41:00                27        141.47        141.47       141.45
## 645786 2013-10-30 17:42:00                21        141.45        141.45       141.44
## 645787 2013-10-30 17:43:00                11        141.45        141.45       141.44
## 645788 2013-10-30 17:44:00                31        141.45        141.46       141.44
## 645789 2013-10-30 17:45:00                73        141.45        141.46       141.44
## 645790 2013-10-30 17:46:00                38        141.45        141.45       141.43
##        close_German10 n_bids_German10 n_trades_German5 open_German5 high_German5
## 645785         141.45              46               14       124.88       124.88
## 645786         141.45              32                1       124.87       124.87
## 645787         141.45              53                1       124.87       124.87
## 645788         141.46              72                7       124.87       124.88
## 645789         141.45              83                1       124.87       124.87
## 645790         141.43              76                6       124.87       124.87
##        low_German5 close_German5 n_bids_German5 n_trades_TYc1  open_TYc1  high_TYc1
## 645785      124.87        124.87             49           120 127.750000 127.750000
## 645786      124.87        124.87             16           594 127.750000 127.796875
## 645787      124.87        124.87             10           130 127.796875 127.796875
## 645788      124.87        124.88             28           251 127.781250 127.781250
## 645789      124.87        124.87             25           197 127.765625 127.781250
## 645790      124.86        124.86             24           435 127.781250 127.796875
##          low_TYc1 close_TYc1 n_bids_TYc1 n_trades_US5Y   open_US5Y   high_US5Y
## 645785 127.750000 127.750000         201            37 121.7812500 121.7812500
## 645786 127.750000 127.796875        1088           373 121.7812500 121.7968750
## 645787 127.781250 127.781250         332           156 121.7968750 121.8046875
## 645788 127.765625 127.765625         301           126 121.7968750 121.7968750
## 645789 127.765625 127.781250         410            96 121.7890625 121.7968750
## 645790 127.781250 127.796875         925           109 121.7968750 121.7968750
##           low_US5Y  close_US5Y n_bids_US5Y n_trades_EUR_USD open_EUR_USD high_EUR_USD
## 645785 121.7812500 121.7812500         320               70       1.3761       1.3763
## 645786 121.7812500 121.7968750         917              205       1.3761       1.3764
## 645787 121.7968750 121.7968750         360               36       1.3761       1.3761
## 645788 121.7890625 121.7890625         299              121       1.3760       1.3760
## 645789 121.7890625 121.7968750         332              258       1.3760       1.3761
## 645790 121.7968750 121.7968750         616              197       1.3756       1.3759
##        low_EUR_USD close_EUR_USD n_bids_EUR_USD
## 645785      1.3761        1.3761            366
## 645786      1.3761        1.3761            502
## 645787      1.3760        1.3760            255
## 645788      1.3759        1.3760            361
## 645789      1.3756        1.3756            796
## 645790      1.3756        1.3758            779
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">tail</span><span class="hl std">(</span><span class="hl kwd">my_data</span><span class="hl std">())</span>
</pre></div>
<div class="output"><pre class="knitr r">##                       DATE n_trades_German10 open_German10 high_German10 low_German10
## 646082 2013-10-30 22:38:00                NA            NA            NA           NA
## 646083 2013-10-30 22:39:00                NA            NA            NA           NA
## 646084 2013-10-30 22:40:00                NA            NA            NA           NA
## 646085 2013-10-30 22:41:00                NA            NA            NA           NA
## 646086 2013-10-30 22:42:00                NA            NA            NA           NA
## 646087 2013-10-30 22:43:00                NA            NA            NA           NA
##        close_German10 n_bids_German10 n_trades_German5 open_German5 high_German5
## 646082             NA              NA               NA           NA           NA
## 646083             NA              NA               NA           NA           NA
## 646084             NA              NA               NA           NA           NA
## 646085             NA              NA               NA           NA           NA
## 646086             NA              NA               NA           NA           NA
## 646087             NA              NA               NA           NA           NA
##        low_German5 close_German5 n_bids_German5 n_trades_TYc1  open_TYc1  high_TYc1
## 646082          NA            NA             NA           467 128.000000 128.031250
## 646083          NA            NA             NA           494 128.015625 128.015625
## 646084          NA            NA             NA           293 127.984375 128.000000
## 646085          NA            NA             NA            15 127.984375 127.984375
## 646086          NA            NA             NA            27 127.984375 127.984375
## 646087          NA            NA             NA           244 127.984375 127.984375
##          low_TYc1 close_TYc1 n_bids_TYc1 n_trades_US5Y   open_US5Y   high_US5Y
## 646082 128.000000 128.015625         693           143 121.9296875 121.9375000
## 646083 127.984375 127.984375         587           107 121.9375000 121.9375000
## 646084 127.984375 127.984375         401            84 121.9218750 121.9218750
## 646085 127.984375 127.984375         176           178 121.9140625 121.9140625
## 646086 127.984375 127.984375         145            30 121.9062500 121.9140625
## 646087 127.968750 127.968750         425            23 121.9140625 121.9140625
##           low_US5Y  close_US5Y n_bids_US5Y n_trades_EUR_USD open_EUR_USD high_EUR_USD
## 646082 121.9296875 121.9375000         281               57       1.3767       1.3768
## 646083 121.9218750 121.9218750         280               88       1.3767       1.3769
## 646084 121.9140625 121.9140625         212               47       1.3767       1.3768
## 646085 121.9062500 121.9062500         242               61       1.3768       1.3768
## 646086 121.9062500 121.9140625         110               41       1.3765       1.3766
## 646087 121.9140625 121.9140625          99               36       1.3766       1.3767
##        low_EUR_USD close_EUR_USD n_bids_EUR_USD
## 646082      1.3767        1.3767            191
## 646083      1.3767        1.3767            303
## 646084      1.3766        1.3768            300
## 646085      1.3765        1.3765            310
## 646086      1.3765        1.3766            269
## 646087      1.3765        1.3765            220
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># let's sell everything</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>  <span class="hl com"># we now have some assets, and less money</span>
</pre></div>
<div class="output"><pre class="knitr r">##    money German10  German5     TYc1     US5Y  EUR_USD 
##   987513        0     -100        0        0        0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_assets_enter_price</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##     0.00   124.87     0.00     0.00     0.00
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_assets_exit_price</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##    German10     German5        TYc1        US5Y     EUR_USD 
## 141.4500000 124.8900000 127.9687500 121.9140625   1.3765000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">estimated_total_money</span><span class="hl std">()</span>  <span class="hl com"># we have lost 2 coins because we use short, and the price went up</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money 
## 999998.0003
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># let's see how much we get:</span>
<span class="hl kwd">sell_everything</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##        0        0        0        0        0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">get_data</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##                       DATE n_trades_German10 open_German10 high_German10 low_German10
## 646088 2013-10-30 22:44:00                NA            NA            NA           NA
##        close_German10 n_bids_German10 n_trades_German5 open_German5 high_German5
## 646088             NA              NA               NA           NA           NA
##        low_German5 close_German5 n_bids_German5 n_trades_TYc1 open_TYc1  high_TYc1
## 646088          NA            NA             NA           166 127.96875 127.984375
##         low_TYc1 close_TYc1 n_bids_TYc1 n_trades_US5Y   open_US5Y  high_US5Y    low_US5Y
## 646088 127.96875 127.984375         380           156 121.9140625 121.921875 121.9140625
##        close_US5Y n_bids_US5Y n_trades_EUR_USD open_EUR_USD high_EUR_USD low_EUR_USD
## 646088 121.921875         235               11       1.3765       1.3767      1.3765
##        close_EUR_USD n_bids_EUR_USD
## 646088        1.3767            197
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_assets</span><span class="hl std">()</span>  <span class="hl com"># we lost 2 coins...</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money    German10     German5        TYc1        US5Y     EUR_USD 
## 999998.0003      0.0000      0.0000      0.0000      0.0000      0.0000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_assets_enter_price</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##    German10     German5        TYc1        US5Y     EUR_USD 
## 141.4500000 124.8900000 127.9687500 121.9140625   1.3765000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_assets_exit_price</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##   German10    German5       TYc1       US5Y    EUR_USD 
## 141.450000 124.890000 127.984375 121.921875   1.376700
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># we earned 2 coins.</span>


<span class="hl com"># What if we work with long?</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money    German10     German5        TYc1        US5Y     EUR_USD 
## 999998.0003      0.0000      0.0000      0.0000      0.0000      0.0000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_bids</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">100</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">))</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##       NA       NA      100       NA       NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">300</span><span class="hl std">)</span> <span class="hl kwd">get_data</span><span class="hl std">()</span>
<span class="hl kwd">my_assets_enter_price</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##    German10     German5        TYc1        US5Y     EUR_USD 
## 141.4500000 124.8900000 127.9843750 121.9140625   1.3765000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_assets_exit_price</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##   German10    German5       TYc1       US5Y    EUR_USD 
## 141.450000 124.890000 127.406250 121.609375   1.372500
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">estimated_total_money</span><span class="hl std">()</span>  <span class="hl com"># at first round, we will have the same ammount of money as we started with.</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money 
## 999940.1878
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sell_everything</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##        0        0        0        0        0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">get_data</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##                       DATE n_trades_German10 open_German10 high_German10 low_German10
## 646389 2013-10-31 04:45:00                NA            NA            NA           NA
##        close_German10 n_bids_German10 n_trades_German5 open_German5 high_German5
## 646389             NA              NA               NA           NA           NA
##        low_German5 close_German5 n_bids_German5 n_trades_TYc1 open_TYc1 high_TYc1
## 646389          NA            NA             NA             2 127.40625 127.40625
##         low_TYc1 close_TYc1 n_bids_TYc1 n_trades_US5Y open_US5Y high_US5Y low_US5Y
## 646389 127.40625  127.40625          26            NA        NA        NA       NA
##        close_US5Y n_bids_US5Y n_trades_EUR_USD open_EUR_USD high_EUR_USD low_EUR_USD
## 646389         NA          NA                2       1.3725       1.3725      1.3724
##        close_EUR_USD n_bids_EUR_USD
## 646389        1.3724             30
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_assets</span><span class="hl std">()</span>  <span class="hl com"># we lost more money...</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money    German10     German5        TYc1        US5Y     EUR_USD 
## 999940.1878      0.0000      0.0000      0.0000      0.0000      0.0000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Let's try short again</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money    German10     German5        TYc1        US5Y     EUR_USD 
## 999940.1878      0.0000      0.0000      0.0000      0.0000      0.0000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_bids</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl opt">-</span><span class="hl num">100</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">))</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##       NA       NA     -100       NA       NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">300</span><span class="hl std">)</span> <span class="hl kwd">get_data</span><span class="hl std">()</span>
<span class="hl kwd">my_assets_enter_price</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##   German10    German5       TYc1       US5Y    EUR_USD 
## 141.450000 124.890000 127.406250 121.609375   1.372500
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_assets_exit_price</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##    German10     German5        TYc1        US5Y     EUR_USD 
## 142.2200000 125.2800000 127.4531250 121.6640625   1.3709000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">estimated_total_money</span><span class="hl std">()</span>  <span class="hl com"># at first round, we will have the same ammount of money as we started with.</span>
</pre></div>
<div class="output"><pre class="knitr r">##      money 
## 999935.502
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sell_everything</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##        0        0        0        0        0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">get_data</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##                       DATE n_trades_German10 open_German10 high_German10 low_German10
## 646690 2013-10-31 09:46:00               245        142.22        142.25       142.22
##        close_German10 n_bids_German10 n_trades_German5 open_German5 high_German5
## 646690         142.23             213               87       125.29       125.29
##        low_German5 close_German5 n_bids_German5 n_trades_TYc1 open_TYc1 high_TYc1
## 646690      125.28        125.29            143            NA        NA        NA
##        low_TYc1 close_TYc1 n_bids_TYc1 n_trades_US5Y   open_US5Y   high_US5Y    low_US5Y
## 646690       NA         NA          NA             2 121.6640625 121.6640625 121.6640625
##         close_US5Y n_bids_US5Y n_trades_EUR_USD open_EUR_USD high_EUR_USD low_EUR_USD
## 646690 121.6640625          21               30        1.371        1.371      1.3709
##        close_EUR_USD n_bids_EUR_USD
## 646690        1.3709             74
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_assets</span><span class="hl std">()</span>  <span class="hl com"># we lost even more money...</span>
</pre></div>
<div class="output"><pre class="knitr r">##      money   German10    German5       TYc1       US5Y    EUR_USD 
## 999935.502      0.000      0.000      0.000      0.000      0.000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># you can NOT buy more than what you have in the bank...</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##      money   German10    German5       TYc1       US5Y    EUR_USD 
## 999935.502      0.000      0.000      0.000      0.000      0.000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_bids</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl opt">^</span><span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">))</span>
</pre></div>
<div class="output"><pre class="knitr r">##    German10     German5        TYc1        US5Y     EUR_USD 
##          NA          NA 10000000000          NA          NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">a</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">get_data</span><span class="hl std">()</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>  <span class="hl com"># we only got a limited ammount of stock...</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money    German10     German5        TYc1        US5Y     EUR_USD 
##    0.000000    0.000000    0.000000 7845.515769    0.000000    0.000000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># let's keep this position for 10 more time stemps</span>
<span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">10</span><span class="hl std">)</span> <span class="hl kwd">get_data</span><span class="hl std">()</span>
<span class="hl com"># and now let's sell everything:</span>
<span class="hl kwd">sell_everything</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## German10  German5     TYc1     US5Y  EUR_USD 
##        0        0        0        0        0
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">a</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">get_data</span><span class="hl std">()</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money    German10     German5        TYc1        US5Y     EUR_USD 
## 1000058.088       0.000       0.000       0.000       0.000       0.000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># we've made a bunch of money thanks to that one position</span>

<span class="hl com"># If I have no money, I can not buy new things</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money    German10     German5        TYc1        US5Y     EUR_USD 
## 1000058.088       0.000       0.000       0.000       0.000       0.000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_bids</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl opt">^</span><span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">))</span>
</pre></div>
<div class="output"><pre class="knitr r">##    German10     German5        TYc1        US5Y     EUR_USD 
##          NA          NA 10000000000          NA          NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">a</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">get_data</span><span class="hl std">()</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>  <span class="hl com"># we only got a limited ammount of stock...</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money    German10     German5        TYc1        US5Y     EUR_USD 
##    0.000000    0.000000    0.000000 7845.515769    0.000000    0.000000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">my_bids</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">10</span><span class="hl opt">^</span><span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">))</span>
</pre></div>
<div class="output"><pre class="knitr r">##    German10     German5        TYc1        US5Y     EUR_USD 
## 10000000000          NA          NA          NA          NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">a</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">get_data</span><span class="hl std">()</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>  <span class="hl com"># No new German10, since we had no money to buy it.</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money    German10     German5        TYc1        US5Y     EUR_USD 
##    0.000000    0.000000    0.000000 7845.515769    0.000000    0.000000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># however: if I sell the TYc1, I would have money to buy German10 and German5</span>
<span class="hl kwd">my_bids</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">10</span><span class="hl opt">^</span><span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl opt">^</span><span class="hl num">10</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">,</span> <span class="hl num">NA</span><span class="hl std">))</span>
</pre></div>
<div class="output"><pre class="knitr r">##    German10     German5        TYc1        US5Y     EUR_USD 
## 10000000000 10000000000           0          NA          NA
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">a</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">get_data</span><span class="hl std">()</span>
<span class="hl kwd">my_assets</span><span class="hl std">()</span>  <span class="hl com"># No new German10, since we had no money to buy it.</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money    German10     German5        TYc1        US5Y     EUR_USD 
##    0.000000 3738.255414 3738.255414    0.000000    0.000000    0.000000
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">estimated_total_money</span><span class="hl std">()</span>  <span class="hl com"># at first round, we will have the same ammount of money as we started with.</span>
</pre></div>
<div class="output"><pre class="knitr r">##       money 
## 1000058.088
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl num">FALSE</span><span class="hl std">) {</span>
    <span class="hl kwd">require</span><span class="hl std">(knitr)</span>
    <span class="hl com"># stitch_rhtml('creating_rds.r')</span>
    <span class="hl kwd">stitch_rhtml</span><span class="hl std">(</span><span class="hl str">&quot;get_data.r&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">stitch_rhtml</span><span class="hl std">(</span><span class="hl str">&quot;api_example.r&quot;</span><span class="hl std">)</span>

<span class="hl std">}</span>




















<span class="hl com">## =================================== Games to ignore...</span>

<span class="hl kwa">if</span> <span class="hl std">(</span><span class="hl num">FALSE</span><span class="hl std">) {</span>



    <span class="hl com"># going through all of the closes, omitting the NA's, what are the latest closes:</span>
    <span class="hl kwd">my_latest_closes</span><span class="hl std">()</span>
    <span class="hl com"># and my assets?</span>
    <span class="hl kwd">my_assets</span><span class="hl std">()</span>
    <span class="hl com"># and combined they form my total estimated money:</span>
    <span class="hl kwd">estimated_total_money</span><span class="hl std">()</span>



    <span class="hl com">################# We will now build a simple model on our last 10 observations, and use it to predict what</span>
    <span class="hl com">################# will happen next, and use that for placing bids.  we assume we have 1000000 / 100</span>

    <span class="hl std">EUR_USD_silly_bid</span> <span class="hl kwb">&lt;-</span> <span class="hl kwa">function</span><span class="hl std">() {</span>
        <span class="hl std">n_lm_window</span> <span class="hl kwb">&lt;-</span> <span class="hl num">10</span>
        <span class="hl com"># X</span>
        <span class="hl std">dates</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">tail</span><span class="hl std">(</span><span class="hl kwd">as.numeric</span><span class="hl std">(</span><span class="hl kwd">my_data</span><span class="hl std">()</span><span class="hl opt">$</span><span class="hl std">DATE), n_lm_window)</span>
        <span class="hl com"># Y</span>
        <span class="hl std">close_EUR_USD</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">tail</span><span class="hl std">(</span><span class="hl kwd">my_data</span><span class="hl std">()</span><span class="hl opt">$</span><span class="hl std">close_EUR_USD, n_lm_window)</span>
        <span class="hl std">fit</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">lm</span><span class="hl std">(close_EUR_USD</span> <span class="hl opt">~</span> <span class="hl std">dates)</span>

        <span class="hl std">s_fit</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">summary</span><span class="hl std">(fit)</span>
        <span class="hl std">new_EUR_USD_bid</span> <span class="hl kwb">&lt;-</span> <span class="hl std">s_fit</span><span class="hl opt">$</span><span class="hl std">r.squared</span> <span class="hl opt">*</span> <span class="hl kwd">sign</span><span class="hl std">(</span><span class="hl kwd">coef</span><span class="hl std">(fit))[</span><span class="hl num">2</span><span class="hl std">]</span> <span class="hl opt">*</span> <span class="hl num">100</span>

        <span class="hl kwd">unname</span><span class="hl std">(new_EUR_USD_bid)</span>
        <span class="hl com"># plot(close_EUR_USD~dates) abline(fit) str(close_EUR_USD) str(dates)</span>
    <span class="hl std">}</span>


    <span class="hl com"># Let's keep doing the same thing k_runs times:</span>
    <span class="hl std">k_runs</span> <span class="hl kwb">&lt;-</span> <span class="hl num">100</span>
    <span class="hl std">what_did_we_bid</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">numeric</span><span class="hl std">(k_runs)</span>
    <span class="hl kwa">for</span> <span class="hl std">(i</span> <span class="hl kwa">in</span> <span class="hl num">1</span><span class="hl opt">:</span><span class="hl std">k_runs) {</span>
        <span class="hl std">EUR_USD_bid</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">EUR_USD_silly_bid</span><span class="hl std">()</span>

        <span class="hl std">what_did_we_bid[i]</span> <span class="hl kwb">&lt;-</span> <span class="hl std">EUR_USD_bid</span>
        <span class="hl std">new_bids</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">4</span><span class="hl std">), EUR_USD_bid)</span>
        <span class="hl kwd">my_bids</span><span class="hl std">(new_bids)</span>
        <span class="hl kwd">get_data</span><span class="hl std">()</span>
    <span class="hl std">}</span>
    <span class="hl kwd">plot</span><span class="hl std">(what_did_we_bid,</span> <span class="hl kwc">type</span> <span class="hl std">=</span> <span class="hl str">&quot;l&quot;</span><span class="hl std">)</span>
    <span class="hl kwd">abline</span><span class="hl std">(</span><span class="hl kwc">h</span> <span class="hl std">=</span> <span class="hl num">0</span><span class="hl std">)</span>
    <span class="hl kwd">my_assets</span><span class="hl std">()</span>
    <span class="hl kwd">estimated_total_money</span><span class="hl std">()</span>
    <span class="hl com"># this was not such a bright strategy after all...</span>

    <span class="hl com"># you can NOT buy more than what you have in the bank... go bankrupt!</span>
    <span class="hl std">new_bids</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl kwd">rep</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">4</span><span class="hl std">),</span> <span class="hl num">10</span><span class="hl opt">^</span><span class="hl num">10</span><span class="hl std">)</span>
    <span class="hl kwd">my_bids</span><span class="hl std">(new_bids)</span>
    <span class="hl kwd">get_data</span><span class="hl std">()</span>
    <span class="hl kwd">my_assets</span><span class="hl std">()</span>
    <span class="hl kwd">my_bids</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">))</span>
    <span class="hl kwd">sell_everything</span><span class="hl std">()</span>
    <span class="hl kwd">get_data</span><span class="hl std">()</span>
    <span class="hl kwd">my_assets</span><span class="hl std">()</span>




<span class="hl std">}</span>
</pre></div>
</div></div>


  <p>The R session information (including the OS info, R version and all
    packages used):</p>

<div class="chunk" id="session-info"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">sessionInfo</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## R version 3.0.3 (2014-03-06)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## 
## locale:
## [1] LC_COLLATE=Hebrew_Israel.1255  LC_CTYPE=Hebrew_Israel.1255   
## [3] LC_MONETARY=Hebrew_Israel.1255 LC_NUMERIC=C                  
## [5] LC_TIME=Hebrew_Israel.1255    
## 
## attached base packages:
## [1] stats     graphics  grDevices datasets  utils     methods   base     
## 
## other attached packages:
## [1] knitr_1.5       installr_0.14.2
## 
## loaded via a namespace (and not attached):
## [1] evaluate_0.5.1 formatR_0.10   highr_0.3      stringr_0.6.2  tools_3.0.3
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">Sys.time</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] "2014-04-21 20:50:11 IDT"
</pre></div>
</div></div>




</body>
</html>
